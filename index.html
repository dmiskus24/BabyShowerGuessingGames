<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dave & Jaz‚Äôs Baby Shower 50/50 Games</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- EmailJS v4 CDN -->
  <script
    type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
  </script>
  <script type="text/javascript">
    (function() {
      emailjs.init({
        publicKey: "mxzw0uJwmCZOV2XJ_",
      });
    })();
  </script>

  <style>
    :root {
      --rl-navy: #002147;
      --rl-cream: #f7f1e6;
      --rl-cream-light: #fbf7ee;
      --gold: #d4a15c;
      --card-bg: #ffffff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --radius-xl: 18px;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.14);
    }

    * { box-sizing: border-box; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }

    body {
      margin: 0;
      background:
        radial-gradient(circle at top, #dde3ee 0, var(--rl-cream) 40%),
        linear-gradient(135deg, var(--rl-cream), #fefefe);
      min-height: 100vh;
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 24px 12px 40px;
    }

    .page {
      width: 100%;
      max-width: 1100px;
      background: linear-gradient(135deg, #ffffff 0, var(--rl-cream-light) 60%, #ffffff 100%);
      border-radius: 28px;
      box-shadow: var(--shadow-soft);
      padding: 26px 18px 30px;
      border: 1px solid #e5e7eb;
      position: relative;
      overflow: hidden;
    }

    .page::before {
      content: "üß∏";
      position: absolute;
      font-size: 5rem;
      opacity: 0.05;
      left: -6px;
      top: 8px;
      transform: rotate(-12deg);
      pointer-events: none;
    }

    .page::after {
      content: "üß∏";
      position: absolute;
      font-size: 5rem;
      opacity: 0.05;
      right: -4px;
      bottom: -10px;
      transform: rotate(10deg);
      pointer-events: none;
    }

    @media (min-width: 768px) {
      .page { padding: 32px 40px 40px; }
    }

    header {
      text-align: center;
      margin-bottom: 26px;
      position: relative;
      z-index: 1;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.9);
      color: var(--rl-navy);
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      border: 1px solid rgba(0, 33, 71, 0.18);
    }

    .pill span { width: 7px; height: 7px; border-radius: 999px; background: var(--gold); }

    h1 {
      font-size: clamp(1.9rem, 2.4vw + 1.4rem, 2.7rem);
      margin: 12px 0 8px;
      color: var(--rl-navy);
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 0.95rem;
      max-width: 650px;
      margin: 0 auto 8px;
    }

    .subtitle-strong { font-size: 0.9rem; margin-top: 4px; }

    .money-note {
      font-size: 0.9rem;
      color: var(--rl-navy);
      background: rgba(249, 250, 251, 0.96);
      border-radius: 999px;
      padding: 8px 16px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid var(--gold);
      margin-top: 6px;
    }

    .money-note strong { font-weight: 700; }
    .money-note-emoji { font-size: 1.1rem; }

    .note-etransfer {
      margin-top: 10px;
      font-size: 0.82rem;
      font-style: italic;
      color: #4b5563;
    }
    .note-etransfer strong { color: var(--rl-navy); }

    main {
      display: grid;
      grid-template-columns: 1fr;
      gap: 18px;
      margin-top: 14px;
      position: relative;
      z-index: 1;
    }

    @media (min-width: 900px) {
      main { grid-template-columns: 1fr 1fr; gap: 20px; }
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      padding: 18px 18px 20px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
      display: flex;
      flex-direction: column;
      gap: 12px;
      border: 1px solid #e5e7eb;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "üß∏";
      position: absolute;
      font-size: 3.5rem;
      opacity: 0.08;
      right: 12px;
      bottom: 6px;
      pointer-events: none;
    }

    .card-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; }

    .card-title {
      font-size: 1.1rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--rl-navy);
    }

    .card-tag {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--rl-navy);
      background: #e5e7eb;
      padding: 3px 8px;
      border-radius: 999px;
      font-weight: 600;
      border: 1px solid rgba(31, 41, 55, 0.18);
    }

    .card-desc { font-size: 0.88rem; color: var(--text-muted); margin-top: 4px; }

    .prize-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(212, 161, 92, 0.08);
      border: 1px solid rgba(212, 161, 92, 0.75);
      color: var(--rl-navy);
      font-size: 0.8rem;
    }
    .prize-pill-emoji { font-size: 1rem; }
    .prize-pill-amount { font-weight: 700; }

    form { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 4px; }

    .field { display: flex; flex-direction: column; gap: 4px; font-size: 0.85rem; }
    label { font-weight: 600; color: #374151; }

    input, select {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 8px 12px;
      font-size: 0.9rem;
      outline: none;
      background: #f9fafb;
      transition: border 0.15s ease, box-shadow 0.15s ease, background 0.15s ease, transform 0.05s ease;
    }

    input:focus, select:focus {
      border-color: var(--gold);
      background: #ffffff;
      box-shadow: 0 0 0 1px #fbbf24;
      transform: translateY(-0.5px);
    }

    .hint { font-size: 0.75rem; color: var(--text-muted); }

    .checkbox-row { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; margin-top: 2px; }
    .checkbox-row input[type="checkbox"] { width: 15px; height: 15px; border-radius: 4px; padding: 0; }

    button {
      border: none;
      border-radius: 999px;
      padding: 9px 14px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.12s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--rl-navy), #000814);
      color: white;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.55);
      width: 100%;
      border: 1px solid var(--gold);
    }

    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 12px 24px rgba(15, 23, 42, 0.65); }

    .btn-secondary {
      background: #f3f4f6;
      color: #374151;
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 0.8rem;
      border: 1px solid #d1d5db;
    }
    .btn-secondary:hover { background: #e5e7eb; }

    .btn-delete {
      background: #fee2e2;
      color: #b91c1c;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.75rem;
      border: 1px solid #fecaca;
      cursor: pointer;
    }
    .btn-delete:hover { background: #fecaca; }

    .button-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-top: 4px; }
    .button-row span { font-size: 0.8rem; color: var(--text-muted); }

    .table-wrapper {
      margin-top: 10px;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      overflow: hidden;
      background: #f9fafb;
    }

    table { width: 100%; border-collapse: collapse; font-size: 0.78rem; }
    thead { background: #e5e7eb; }
    th, td { padding: 7px 10px; text-align: left; white-space: nowrap; }
    th { font-weight: 700; font-size: 0.75rem; color: #374151; }
    tbody tr:nth-child(even) { background: #f9fafb; }
    tbody tr:nth-child(odd) { background: #ffffff; }

    .empty-state { padding: 10px 12px; font-size: 0.8rem; color: var(--text-muted); text-align: center; }

    /* Display board section */
    .display-section {
      margin-top: 30px;
      padding: 18px 16px 20px;
      border-radius: 22px;
      background: linear-gradient(135deg, var(--rl-navy), #00152f);
      color: #f9fafb;
      border: 1px solid rgba(212, 161, 92, 0.7);
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.45);
      position: relative;
      overflow: hidden;
    }

    .display-section::before {
      content: "üß∏";
      position: absolute;
      font-size: 4.5rem;
      opacity: 0.15;
      right: 16px;
      top: -10px;
      transform: rotate(10deg);
      pointer-events: none;
    }

    .display-header { text-align: center; margin-bottom: 14px; position: relative; z-index: 1; }
    .display-title { font-size: 1.3rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; margin: 0 0 4px; }
    .display-subtitle { font-size: 0.85rem; opacity: 0.9; }

    .display-grid { display: grid; grid-template-columns: 2.3fr 1.7fr; gap: 14px; position: relative; z-index: 1; }
    @media (max-width: 900px) { .display-grid { grid-template-columns: 1fr; } }

    .display-card {
      background: rgba(247, 241, 230, 0.09);
      border-radius: 16px;
      padding: 14px 14px 12px;
      border: 1px solid rgba(249, 250, 251, 0.28);
      backdrop-filter: blur(4px);
    }

    .display-card-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .display-card-title span { font-size: 0.85rem; color: #e5e7eb; opacity: 0.9; }

    .display-board { max-height: 280px; overflow-y: auto; padding-right: 4px; }

    /* Arrival slots board */
    .slot-day { margin-bottom: 10px; }

    .slot-day-header {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #e5e7eb;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .slot-day-header span {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(249, 250, 251, 0.35);
      color: #fefefe;
    }

    .slot-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 6px; }

    .slot-card {
      border-radius: 12px;
      padding: 6px 6px 5px;
      font-size: 0.75rem;
      text-align: center;
      border: 1px solid rgba(249, 250, 251, 0.35);
      background: rgba(247, 241, 230, 0.08);
      transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.12s ease, opacity 0.12s ease;
      user-select: none;
    }

    .slot-card-time { font-weight: 600; margin-bottom: 2px; }
    .slot-card-status { font-size: 0.7rem; }

    .slot-card.available { background: rgba(247, 241, 230, 0.22); color: #fefefe; cursor: pointer; }
    .slot-card.available:hover { transform: translateY(-1px); box-shadow: 0 8px 14px rgba(15, 23, 42, 0.4); }

    .slot-card.taken { background: rgba(31, 41, 55, 0.4); border-color: rgba(148, 163, 184, 0.9); color: #e5e7eb; opacity: 0.7; cursor: not-allowed; }
    .slot-card.taken .slot-card-time { color: #f9fafb; }

    /* Weight board */
    .weight-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 8px; }

    .weight-card {
      border-radius: 14px;
      padding: 7px 6px 6px;
      font-size: 0.78rem;
      text-align: center;
      border: 1px solid rgba(249, 250, 251, 0.35);
      background: rgba(247, 241, 230, 0.1);
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.12s ease;
      user-select: none;
    }

    .weight-card-value { font-weight: 700; margin-bottom: 2px; font-size: 0.8rem; }
    .weight-card-status { font-size: 0.72rem; }

    .weight-card.available { background: rgba(247, 241, 230, 0.22); color: #fefefe; }
    .weight-card.available:hover { transform: translateY(-1px); box-shadow: 0 8px 14px rgba(15, 23, 42, 0.4); }

    .weight-card.taken { background: rgba(37, 99, 235, 0.25); border-color: rgba(191, 219, 254, 0.95); color: #eff6ff; }
    .weight-card.taken .weight-card-value { color: #eff6ff; }

    /* NEW: selected highlight */
    .is-selected {
      outline: 2px solid rgba(212,161,92,0.95);
      box-shadow: 0 10px 18px rgba(15,23,42,0.35);
      transform: translateY(-1px);
    }

    /* NEW: hide inputs for board-picker-only mode */
    .picker-hidden { display: none !important; }

    .display-empty { font-size: 0.8rem; opacity: 0.8; text-align: center; padding: 8px 4px 4px; }

    footer { margin-top: 24px; text-align: center; font-size: 0.75rem; color: var(--text-muted); position: relative; z-index: 1; }

    .footer-note {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(249, 250, 251, 0.96);
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px dashed #d1d5db;
    }

    .footer-note strong { font-weight: 700; color: #4b5563; }
  </style>
</head>

<body>
  <div class="page">
    <header>
      <div class="pill">
        <span></span>
        Dave &amp; Jaz‚Äôs Baby Shower ‚Ä¢ January 10, 2026
      </div>
      <h1>Place Your Baby Guess! üß∏</h1>
      <p class="subtitle">
        Help celebrate <strong>Dave &amp; Jaz</strong> as they get ready to meet their little one,
        expected around <strong>March 14</strong>. Join in the fun by guessing
        <strong>when</strong> baby will arrive and <strong>how much</strong> baby will weigh.
      </p>
      <p class="subtitle subtitle-strong">
        Each guess is <strong>$5</strong> and goes into a 50/50 prize pot for the closest predictions.
      </p>
      <div class="money-note">
        <span class="money-note-emoji">üí∏</span>
        <span>
          <strong>50/50:</strong> Half the pot goes to the lucky winner(s), half goes to
          Dave, Jaz &amp; baby.
        </span>
      </div>
      <p class="subtitle note-etransfer">
        Please send your <strong>$5 per guess</strong> by e-transfer to
        <strong>dmiskus24@gmail.com</strong> or bring cash to the shower.
        Make sure to note your name and which game(s) you‚Äôre playing.
      </p>
    </header>

    <main>
      <!-- ARRIVAL -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              Guess Baby‚Äôs Arrival
              <span class="card-tag">Board Picker</span>
            </div>
            <p class="card-desc">
              Tap one or more <strong>available</strong> hour slots on the board (below). Your selected picks will show here.
            </p>
            <div class="prize-pill">
              <span class="prize-pill-emoji">üèÜ</span>
              <span>Winner Takes Home:</span>
              <span class="prize-pill-amount">$<span id="arrival-prize">0.00</span></span>
            </div>
          </div>
        </div>

        <form id="arrival-form">
          <div class="field">
            <label for="arrival-name">Your name*</label>
            <input type="text" id="arrival-name" required placeholder="First &amp; last name" />
          </div>

          <div class="field">
            <label for="arrival-email">Email (optional)</label>
            <input type="email" id="arrival-email" placeholder="So Dave &amp; Jaz can contact the winner" />
          </div>

          <!-- HIDDEN: old date/time inputs -->
          <div class="picker-hidden">
            <input type="date" id="arrival-date" />
            <select id="arrival-time"></select>
          </div>

          <!-- NEW: selected summary -->
          <div class="field">
            <label>Selected arrival slot(s)</label>
            <div class="hint">
              <span id="arrival-selected-list">None</span>
            </div>
          </div>

          <div class="field">
            <label for="arrival-payment">Payment method</label>
            <select id="arrival-payment">
              <option value="">Select an option</option>
              <option value="etransfer">E-transfer sent</option>
              <option value="cash-shower">Cash at shower</option>
              <option value="other">Other / coordinating with host</option>
            </select>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="arrival-paid" />
            <label for="arrival-paid" style="font-weight: 500">
              I‚Äôve sent / will bring my <strong>$5</strong> for these pick(s).
            </label>
          </div>

          <div class="button-row">
            <button type="button" class="btn-secondary" id="arrival-clear">Clear selected</button>
            <button type="submit" class="btn-primary">Submit Selected Arrival Slot(s) ‚ú®</button>
          </div>
        </form>

        <div class="table-wrapper">
          <table id="arrival-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Date</th>
                <th>Hour</th>
                <th>Paid</th>
                <th>Payment</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody id="arrival-tbody"></tbody>
          </table>
          <div id="arrival-empty" class="empty-state">
            No guesses yet. Be the first to claim your hour!
          </div>
        </div>

        <div class="button-row">
          <span>Host tools:</span>
          <button id="arrival-download" class="btn-secondary" type="button">
            Download Arrival Guesses (CSV)
          </button>
        </div>
      </section>

      <!-- WEIGHT -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              Guess Baby‚Äôs Weight
              <span class="card-tag">Board Picker</span>
            </div>
            <p class="card-desc">
              Tap one or more weights on the board (below). Weight tiles can be picked even if others already guessed it.
            </p>
            <div class="prize-pill">
              <span class="prize-pill-emoji">üèÜ</span>
              <span>Winner Takes Home:</span>
              <span class="prize-pill-amount">$<span id="weight-prize">0.00</span></span>
            </div>
          </div>
        </div>

        <form id="weight-form">
          <div class="field">
            <label for="weight-name">Your name*</label>
            <input type="text" id="weight-name" required placeholder="First &amp; last name" />
          </div>

          <div class="field">
            <label for="weight-email">Email (optional)</label>
            <input type="email" id="weight-email" placeholder="So Dave &amp; Jaz can contact the winner" />
          </div>

          <!-- HIDDEN: old lbs/oz inputs -->
          <div class="picker-hidden">
            <input type="number" id="weight-lbs" />
            <input type="number" id="weight-oz" />
          </div>

          <!-- NEW: selected summary -->
          <div class="field">
            <label>Selected weight guess(es)</label>
            <div class="hint">
              <span id="weight-selected-list">None</span>
            </div>
          </div>

          <div class="field">
            <label for="weight-payment">Payment method</label>
            <select id="weight-payment">
              <option value="">Select an option</option>
              <option value="etransfer">E-transfer sent</option>
              <option value="cash-shower">Cash at shower</option>
              <option value="other">Other / coordinating with host</option>
            </select>
          </div>

          <div class="checkbox-row">
            <input type="checkbox" id="weight-paid" />
            <label for="weight-paid" style="font-weight: 500">
              I‚Äôve sent / will bring my <strong>$5</strong> for these pick(s).
            </label>
          </div>

          <div class="button-row">
            <button type="button" class="btn-secondary" id="weight-clear">Clear selected</button>
            <button type="submit" class="btn-primary">Submit Selected Weight Guess(es) üéØ</button>
          </div>
        </form>

        <div class="table-wrapper">
          <table id="weight-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Weight</th>
                <th>Paid</th>
                <th>Payment</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody id="weight-tbody"></tbody>
          </table>
          <div id="weight-empty" class="empty-state">
            No weight guesses yet. Add yours to grow the pot!
          </div>
        </div>

        <div class="button-row">
          <span>Host tools:</span>
          <button id="weight-download" class="btn-secondary" type="button">
            Download Weight Guesses (CSV)
          </button>
        </div>
      </section>
    </main>

    <!-- DISPLAY BOARD SECTION -->
    <section class="display-section">
      <div class="display-header">
        <div class="display-title">Game Board</div>
        <div class="display-subtitle">
          Reserved arrival hours &amp; baby weight guesses ‚Ä¢ Perfect for TV / iPad display during the shower.
        </div>
      </div>

      <div class="display-grid">
        <div class="display-card">
          <div class="display-card-title">
            Arrival Date &amp; Hour Slots
            <span id="arrival-display-count">0 of 0 slots taken</span>
          </div>
          <div class="display-board" id="arrival-display-board"></div>
        </div>

        <div class="display-card">
          <div class="display-card-title">
            Baby Weight Guess Board
            <span id="weight-display-count">0 guesses</span>
          </div>
          <div class="display-board" id="weight-display-board"></div>
          <div id="weight-display-empty" class="display-empty">
            No weight guesses yet. They‚Äôll appear here as they‚Äôre added.
          </div>
        </div>
      </div>
    </section>

    <footer>
      <div class="footer-note">
        <span>üßæ</span>
        <span>
          <strong>Host tip:</strong> Guesses are stored online in Firebase so any device can see the same board.
        </span>
      </div>
    </footer>
  </div>

  <!-- MAIN LOGIC + FIREBASE (Realtime DB) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getDatabase, ref, push, set, remove, onValue } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyClsGV9kGYGDaQqoFFEv4xZegzhLtKGCKo",
      authDomain: "babyguessinggame-6fee6.firebaseapp.com",
      databaseURL: "https://babyguessinggame-6fee6-default-rtdb.firebaseio.com",
      projectId: "babyguessinggame-6fee6",
      storageBucket: "babyguessinggame-6fee6.firebasestorage.app",
      messagingSenderId: "607510341848",
      appId: "1:607510341848:web:8676eb777010e8a9bc8fad",
      measurementId: "G-D8CKX8NE39"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const arrivalRef = ref(db, "arrivalGuesses");
    const weightRef  = ref(db, "weightGuesses");

    const auth = getAuth(app);
    signInAnonymously(auth).catch((error) => console.error("Anonymous sign-in error:", error));

    // ------------- HELPERS / CONSTANTS -------------
    const GUESS_COST = 5;

    function getArrivalBoardDates() {
      const dates = [];
      const start = new Date(2026, 2, 1);
      const end   = new Date(2026, 2, 31);
      let d = new Date(start);
      while (d <= end) {
        const year  = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, "0");
        const day   = String(d.getDate()).padStart(2, "0");
        dates.push(`${year}-${month}-${day}`);
        d.setDate(d.getDate() + 1);
      }
      return dates;
    }

    const ARRIVAL_BOARD_HOURS = [
      "00:00","01:00","02:00","03:00","04:00","05:00",
      "06:00","07:00","08:00","09:00","10:00","11:00",
      "12:00","13:00","14:00","15:00","16:00","17:00",
      "18:00","19:00","20:00","21:00","22:00","23:00"
    ];

    const WEIGHT_BOARD_SLOTS = [];
    (function buildWeightSlots() {
      for (let lbs = 6; lbs <= 10; lbs++) {
        for (let oz = 0; oz <= 15; oz++) WEIGHT_BOARD_SLOTS.push({ lbs, oz });
      }
    })();

    function toggleEmptyState(list, emptyEl) {
      if (!emptyEl) return;
      emptyEl.style.display = (!list || list.length === 0) ? "block" : "none";
    }

    function downloadCSV(filename, rows) {
      if (!rows || rows.length === 0) { alert("No data to download yet."); return; }
      const escapeCell = (value) => {
        if (value == null) return "";
        const str = String(value);
        if (str.includes('"') || str.includes(",") || str.includes("\n")) return '"' + str.replace(/"/g, '""') + '"';
        return str;
      };
      const csvContent = rows.map((row) => row.map(escapeCell).join(",")).join("\n");
      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.setAttribute("href", url);
      link.setAttribute("download", filename);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    function formatTimeDisplay(time) {
      if (!time) return "";
      const [hStr] = time.split(":");
      let h = parseInt(hStr, 10);
      const suffix = h >= 12 ? "PM" : "AM";
      h = h % 12; if (h === 0) h = 12;
      return `${h}:00 ${suffix}`;
    }

    function formatDateLabel(dateStr) {
      if (!dateStr) return "";
      const [year, month, day] = dateStr.split("-").map(Number);
      const d = new Date(year, month - 1, day);
      const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
      const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
      return `${dayNames[d.getDay()]} ${monthNames[d.getMonth()]} ${d.getDate()}`;
    }

    function formatWeightDisplay(lbs, oz) {
      if (oz && oz > 0) return `${lbs} lbs ${oz} oz`;
      return `${lbs} lbs`;
    }

    function formatCurrency(amount) {
      return amount.toLocaleString("en-CA", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function calculatePrize(guessCount) { return (guessCount * GUESS_COST) / 2; }

    // EmailJS configuration
    const EMAILJS_SERVICE_ID = "service_3yy9boh";
    const EMAILJS_TEMPLATE_ID_ARRIVAL = "template_4al0a9v";
    const EMAILJS_TEMPLATE_ID_WEIGHT  = "template_dimfh3o";

    function sendConfirmationEmail(type, guess) {
      if (!guess.email) return;

      let templateId;
      let params;

      if (type === "arrival") {
        templateId = EMAILJS_TEMPLATE_ID_ARRIVAL;
        params = {
          to_email: guess.email,
          to_name: guess.name || "",
          game_type: "Arrival Date & Time",
          arrival_date: guess.date,
          arrival_time: formatTimeDisplay(guess.time),
          payment: guess.payment || "Not specified",
          paid: guess.paid ? "Yes" : "No",
        };
      } else if (type === "weight") {
        templateId = EMAILJS_TEMPLATE_ID_WEIGHT;
        params = {
          to_email: guess.email,
          to_name: guess.name || "",
          game_type: "Baby Weight",
          weight: formatWeightDisplay(guess.lbs, guess.oz),
          payment: guess.payment || "Not specified",
          paid: guess.paid ? "Yes" : "No",
        };
      } else return;

      emailjs.send(EMAILJS_SERVICE_ID, templateId, params)
        .then(() => console.log("Email sent:", type, guess.email))
        .catch((error) => console.error("EmailJS error:", error));
    }

    document.addEventListener("DOMContentLoaded", () => {
      // Prize pool elements
      const arrivalPrizeEl = document.getElementById("arrival-prize");
      const weightPrizeEl  = document.getElementById("weight-prize");

      // MULTI-SELECT STATE
      let selectedArrivalSlots = []; // [{date,time}]
      let selectedWeightSlots  = []; // [{lbs,oz}]

      const arrivalSelectedListEl = document.getElementById("arrival-selected-list");
      const weightSelectedListEl  = document.getElementById("weight-selected-list");

      function renderSelectedArrival() {
        if (!arrivalSelectedListEl) return;
        if (selectedArrivalSlots.length === 0) { arrivalSelectedListEl.textContent = "None"; return; }
        arrivalSelectedListEl.textContent = selectedArrivalSlots
          .map(s => `${s.date} @ ${formatTimeDisplay(s.time)}`)
          .join(" ‚Ä¢ ");
      }

      function renderSelectedWeight() {
        if (!weightSelectedListEl) return;
        if (selectedWeightSlots.length === 0) { weightSelectedListEl.textContent = "None"; return; }
        weightSelectedListEl.textContent = selectedWeightSlots
          .map(s => formatWeightDisplay(s.lbs, s.oz))
          .join(" ‚Ä¢ ");
      }

      // ----- ARRIVAL GAME -----
      let arrivalGuesses = [];

      const arrivalTbody = document.getElementById("arrival-tbody");
      const arrivalEmpty = document.getElementById("arrival-empty");
      const arrivalForm  = document.getElementById("arrival-form");
      const arrivalDownload = document.getElementById("arrival-download");
      const arrivalClear = document.getElementById("arrival-clear");

      const arrivalDisplayBoard = document.getElementById("arrival-display-board");
      const arrivalDisplayCount = document.getElementById("arrival-display-count");

      const arrivalNameInput = document.getElementById("arrival-name");

      function updateArrivalPrize() {
        const amount = calculatePrize(arrivalGuesses.length);
        if (arrivalPrizeEl) arrivalPrizeEl.textContent = formatCurrency(amount);
      }

      function gNameOrTaken(g) { return g.name || "Taken"; }

      function renderArrivalTable() {
        arrivalTbody.innerHTML = "";
        toggleEmptyState(arrivalGuesses, arrivalEmpty);

        arrivalGuesses.forEach((g) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${g.name || ""}</td>
            <td>${g.date || ""}</td>
            <td>${formatTimeDisplay(g.time)}</td>
            <td>${g.paid ? "Yes" : "No"}</td>
            <td>${g.payment || ""}</td>
            <td><button class="btn-delete" data-id="${g.id}">‚úï</button></td>
          `;
          arrivalTbody.appendChild(tr);
        });

        updateArrivalPrize();
      }

      function renderArrivalBoard() {
        const dates = getArrivalBoardDates();
        arrivalDisplayBoard.innerHTML = "";

        const totalSlots = dates.length * ARRIVAL_BOARD_HOURS.length;
        let takenCount = 0;

        dates.forEach((dateStr) => {
          const dayDiv = document.createElement("div");
          dayDiv.className = "slot-day";

          const header = document.createElement("div");
          header.className = "slot-day-header";
          header.innerHTML = `${formatDateLabel(dateStr)} <span>${dateStr}</span>`;

          const grid = document.createElement("div");
          grid.className = "slot-grid";

          ARRIVAL_BOARD_HOURS.forEach((time) => {
            const match = arrivalGuesses.find((g) => g.date === dateStr && g.time === time);
            const isSelected = selectedArrivalSlots.some(s => s.date === dateStr && s.time === time);

            const card = document.createElement("div");
            card.className = "slot-card " + (match ? "taken" : "available");
            if (isSelected) card.classList.add("is-selected");

            if (match) takenCount++;

            const timeDiv = document.createElement("div");
            timeDiv.className = "slot-card-time";
            timeDiv.textContent = formatTimeDisplay(time);

            const statusDiv = document.createElement("div");
            statusDiv.className = "slot-card-status";
            statusDiv.textContent = match ? gNameOrTaken(match) : (isSelected ? "Selected" : "Available");

            card.appendChild(timeDiv);
            card.appendChild(statusDiv);

            // Board picker: only allow selecting AVAILABLE slots
            if (!match) {
              card.addEventListener("click", () => {
                const idx = selectedArrivalSlots.findIndex(s => s.date === dateStr && s.time === time);
                if (idx >= 0) selectedArrivalSlots.splice(idx, 1);
                else selectedArrivalSlots.push({ date: dateStr, time });

                renderSelectedArrival();
                renderArrivalBoard();
              });
            }

            grid.appendChild(card);
          });

          dayDiv.appendChild(header);
          dayDiv.appendChild(grid);
          arrivalDisplayBoard.appendChild(dayDiv);
        });

        arrivalDisplayCount.textContent = `${takenCount} of ${totalSlots} slots taken`;
      }

      // Realtime listener
      onValue(arrivalRef, (snapshot) => {
        const data = snapshot.val() || {};
        arrivalGuesses = Object.entries(data).map(([id, value]) => ({
          id,
          name: value.name || "",
          email: value.email || "",
          date: value.date || "",
          time: value.time || "",
          payment: value.payment || "",
          paid: !!value.paid,
          createdAt: value.createdAt || null,
          userId: value.userId || null
        }));
        arrivalGuesses.sort((a, b) => (a.createdAt || 0) - (b.createdAt || 0));

        // If something got taken while a user had it selected, drop it
        selectedArrivalSlots = selectedArrivalSlots.filter(s =>
          !arrivalGuesses.some(g => g.date === s.date && g.time === s.time)
        );

        renderSelectedArrival();
        renderArrivalTable();
        renderArrivalBoard();
      });

      arrivalClear.addEventListener("click", () => {
        selectedArrivalSlots = [];
        renderSelectedArrival();
        renderArrivalBoard();
      });

      arrivalForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const user = auth.currentUser;
        if (!user) { alert("Still connecting to the game, please try again in a moment."); return; }

        const name = arrivalNameInput.value.trim();
        const email = document.getElementById("arrival-email").value.trim();
        const payment = document.getElementById("arrival-payment").value;
        const paid = document.getElementById("arrival-paid").checked;

        if (!name) { alert("Please enter your name."); return; }
        if (selectedArrivalSlots.length === 0) { alert("Please select at least 1 arrival slot on the board."); return; }

        // Last-second duplicate check
        for (const s of selectedArrivalSlots) {
          const exists = arrivalGuesses.some(g => g.date === s.date && g.time === s.time);
          if (exists) {
            alert(`Oops ‚Äî ${s.date} @ ${formatTimeDisplay(s.time)} was just taken. Please reselect.`);
            return;
          }
        }

        try {
          for (const s of selectedArrivalSlots) {
            const guess = {
              userId: user.uid,
              name,
              email,
              date: s.date,
              time: s.time,
              payment,
              paid,
              createdAt: Date.now(),
            };
            const newRef = push(arrivalRef);
            await set(newRef, guess);
            if (email) sendConfirmationEmail("arrival", guess);
          }

          selectedArrivalSlots = [];
          renderSelectedArrival();
          renderArrivalBoard();
          alert("Your selected arrival slot(s) have been recorded. Thank you!");
        } catch (err) {
          console.error("Error saving arrival guesses:", err);
          alert("There was an error saving your guesses. Please try again.");
        }
      });

      arrivalTbody.addEventListener("click", async (e) => {
        const btn = e.target.closest(".btn-delete");
        if (!btn) return;
        const id = btn.getAttribute("data-id");
        if (!id) return;
        if (!confirm("Delete this arrival guess?")) return;
        try { await remove(ref(db, `arrivalGuesses/${id}`)); }
        catch (err) { console.error("Error deleting arrival guess:", err); alert("Could not delete this guess."); }
      });

      arrivalDownload.addEventListener("click", () => {
        const headers = ["Name","Email","Date","Time","Payment Method","Paid","Created At"];
        const rows = [headers];

        arrivalGuesses.forEach((g) => {
          const createdStr = g.createdAt ? new Date(g.createdAt).toISOString() : "";
          rows.push([g.name || "", g.email || "", g.date || "", formatTimeDisplay(g.time), g.payment || "", g.paid ? "Yes" : "No", createdStr]);
        });

        downloadCSV("baby_arrival_guesses.csv", rows);
      });

      // ----- WEIGHT GAME -----
      let weightGuesses = [];

      const weightTbody = document.getElementById("weight-tbody");
      const weightEmpty = document.getElementById("weight-empty");
      const weightForm  = document.getElementById("weight-form");
      const weightDownload = document.getElementById("weight-download");
      const weightClear = document.getElementById("weight-clear");

      const weightDisplayBoard = document.getElementById("weight-display-board");
      const weightDisplayEmpty = document.getElementById("weight-display-empty");
      const weightDisplayCount = document.getElementById("weight-display-count");

      const weightNameInput = document.getElementById("weight-name");

      function updateWeightPrize() {
        const amount = calculatePrize(weightGuesses.length);
        if (weightPrizeEl) weightPrizeEl.textContent = formatCurrency(amount);
      }

      function renderWeightTable() {
        weightTbody.innerHTML = "";
        toggleEmptyState(weightGuesses, weightEmpty);

        weightGuesses.forEach((g) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${g.name}</td>
            <td>${formatWeightDisplay(g.lbs, g.oz)}</td>
            <td>${g.paid ? "Yes" : "No"}</td>
            <td>${g.payment || ""}</td>
            <td><button class="btn-delete" data-id="${g.id}">‚úï</button></td>
          `;
          weightTbody.appendChild(tr);
        });

        updateWeightPrize();
      }

function renderWeightBoard() {
  weightDisplayBoard.innerHTML = "";

  const grid = document.createElement("div");
  grid.className = "weight-grid";

  WEIGHT_BOARD_SLOTS.forEach(({ lbs, oz }) => {
    // ‚úÖ single match (one guess per tile)
    const match = weightGuesses.find((g) => g.lbs === lbs && g.oz === oz);

    const card = document.createElement("div");
    card.className = "weight-card " + (match ? "taken" : "available");

    const valDiv = document.createElement("div");
    valDiv.className = "weight-card-value";
    valDiv.textContent = formatWeightDisplay(lbs, oz);

    const statusDiv = document.createElement("div");
    statusDiv.className = "weight-card-status";
    statusDiv.textContent = match ? (match.name || "Taken") : "Available";

    // ‚úÖ only allow click when available
    if (!match) {
      card.addEventListener("click", () => {
        weightLbsInput.value = lbs;
        weightOzInput.value = oz;
        weightNameInput.focus({ preventScroll: false });
        window.scrollTo({
          top: document.body.scrollHeight / 3,
          behavior: "smooth",
        });
      });
    }

    card.appendChild(valDiv);
    card.appendChild(statusDiv);
    grid.appendChild(card);
  });

  weightDisplayBoard.appendChild(grid);
  toggleEmptyState(weightGuesses, weightDisplayEmpty);

  // ‚úÖ fix small typo too
  weightDisplayCount.textContent =
    `${weightGuesses.length} guess${weightGuesses.length === 1 ? "" : "es"}`;
}


      onValue(weightRef, (snapshot) => {
        const data = snapshot.val() || {};
        weightGuesses = Object.entries(data).map(([id, value]) => ({
          id,
          name: value.name || "",
          email: value.email || "",
          lbs: value.lbs != null ? value.lbs : "",
          oz: value.oz != null ? value.oz : 0,
          payment: value.payment || "",
          paid: !!value.paid,
          createdAt: value.createdAt || null,
          userId: value.userId || null
        }));
        weightGuesses.sort((a, b) => (a.createdAt || 0) - (b.createdAt || 0));

        renderWeightTable();
        renderWeightBoard();
        renderSelectedWeight();
      });

      weightClear.addEventListener("click", () => {
        selectedWeightSlots = [];
        renderSelectedWeight();
        renderWeightBoard();
      });

      weightForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const user = auth.currentUser;
        if (!user) { alert("Still connecting to the game, please try again in a moment."); return; }

        const name = weightNameInput.value.trim();
        const email = document.getElementById("weight-email").value.trim();
        const payment = document.getElementById("weight-payment").value;
        const paid = document.getElementById("weight-paid").checked;

        if (!name) { alert("Please enter your name."); return; }
        if (selectedWeightSlots.length === 0) { alert("Please select at least 1 weight on the board."); return; }

        try {
          for (const s of selectedWeightSlots) {
            const guess = {
              userId: user.uid,
              name,
              email,
              lbs: s.lbs,
              oz: s.oz,
              payment,
              paid,
              createdAt: Date.now(),
            };
            const newRef = push(weightRef);
            await set(newRef, guess);
            if (email) sendConfirmationEmail("weight", guess);
          }

          selectedWeightSlots = [];
          renderSelectedWeight();
          renderWeightBoard();
          alert("Your selected weight guess(es) have been recorded. Thank you!");
        } catch (err) {
          console.error("Error saving weight guesses:", err);
          alert("There was an error saving your guesses. Please try again.");
        }
      });

      weightTbody.addEventListener("click", async (e) => {
        const btn = e.target.closest(".btn-delete");
        if (!btn) return;
        const id = btn.getAttribute("data-id");
        if (!id) return;
        if (!confirm("Delete this weight guess?")) return;
        try { await remove(ref(db, `weightGuesses/${id}`)); }
        catch (err) { console.error("Error deleting weight guess:", err); alert("Could not delete this guess."); }
      });

      weightDownload.addEventListener("click", () => {
        const headers = ["Name","Email","Weight (lbs)","Ounces","Payment Method","Paid","Created At"];
        const rows = [headers];

        weightGuesses.forEach((g) => {
          const createdStr = g.createdAt ? new Date(g.createdAt).toISOString() : "";
          rows.push([g.name || "", g.email || "", g.lbs != null ? g.lbs : "", g.oz != null ? g.oz : "", g.payment || "", g.paid ? "Yes" : "No", createdStr]);
        });

        downloadCSV("baby_weight_guesses.csv", rows);
      });

      // initial renders
      renderSelectedArrival();
      renderSelectedWeight();
      renderArrivalBoard();
      renderWeightBoard();
    });
  </script>
</body>
</html>

